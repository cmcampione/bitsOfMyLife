<!-- weather.page.html -->
<ion-content>
  <!-- Landscape illustration with mascot -->
  <div class="landscape-illustration">
  <div class="mascot"></div>
  </div>
  <!-- Header with search location -->
  <div class="location-header">
  <div class="search-container">
    <div class="search-box">
      <ion-icon name="location-outline" class="location-icon"></ion-icon>
      <div class="location-text">Ricerca</div>
      <ion-avatar class="user-avatar">
        <img src="assets/avatar.png">
      </ion-avatar>
    </div>
  </div>
  </div>
   <!-- Current weather -->
   <app-horizontal-scroll id="scrollHeader" #pageTransition (swipeNext)="nextTimeline()" (swipePrev)="prevTimeline()">
    <div class="current-weather">
      <div class="ora-label">
        {{ (selectedBitsOfMyLifeState$ | async)?.timelineMainDate | date:'EEEE dd MMMM yyyy' }}
      </div>
      <div class="main-temp-container">
        <div class="main-temp">{{ (selectedBitsOfMyLifeState$ | async)?.timelineName }}</div>
      </div>
      
      <div class="min-max-temp">
      </div>

      <div class="weather-description">
        <div class="condition"></div>
        <div class="perceived-temp" *ngIf="isDev()">
          <div>
            <p>DEBUG: Timeline index: {{ (selectedBitsOfMyLifeState$ | async)?.timelineIndex }} Timeline id: {{ (selectedBitsOfMyLifeState$ | async)?.timelineId }} Timelines lenght: {{ (selectedBitsOfMyLifeState$ | async)?.timelinesLenght }} </p>
          </div>
        </div>
      </div>
      <div id="nextPrevButtons">
        <ion-button shape="round" (click)="this.pageTransition.triggerPrevTransition()" fill="outline" class="csButtonHeader">
          <ion-icon slot="icon-only" name="arrow-back-outline"></ion-icon>
        </ion-button>
        <ion-button shape="round" (click)="this.pageTransition.triggerNextTransition()" fill="outline" class="csButtonHeader">
          <ion-icon slot="icon-only" name="arrow-forward-outline"></ion-icon>
        </ion-button>
      </div>
    </div>
  </app-horizontal-scroll>

  <div class="weather-container">
   
   
    <div class="forecast-section">
      <div class="section-title">Oggi</div>
      <div class="days-forecast-list">
        
        <div class="day-row">
          <div class="day-name">
            {{ today | date:'EEEE dd MMMM yyyy' }} <br/>
            <small>Oggi</small>
          </div>
          
        </div>
      </div>
    </div>
  
    <div class="forecast-section">
      <div class="section-title">Altre date</div>
      <div class="days-forecast-list">
        
        <div class="day-row" *ngFor="let bit of (selectedBitsOfMyLifeState$ | async)?.bitsOfMyLife">
          <div class="day-name">
            {{ bit.milestone.date | date:'EEEE dd MMMM yyyy' }} <br/>
            <small>Anni: {{ bit.diff.years }} | Mesi: {{ bit.diff.months }} | Giorni: {{ bit.diff.days }}</small>
          </div>
          <div class="day-forecast">
            <div class="temp-range">
              <div class="action-buttons" *ngIf="bit.milestone.id !== todayMilestoneId">
                <ion-button shape="round" class="edit-button" (click)="editBitOfMyLife(bit)" fill="outline" size="small">
                  <ion-icon slot="icon-only" name="pencil"></ion-icon>
                </ion-button>
                <ion-button shape="round" class="delete-button" (click)="deleteBitOfMyLife(bit.milestone.id)" fill="outline" size="small">
                  <ion-icon slot="icon-only" name="trash"></ion-icon>
                </ion-button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ion-content>
<ion-fab slot="fixed" vertical="bottom" horizontal="end">
  <ion-fab-button (click)="addBitOfMyLife()" color="">
    <ion-icon name="add"></ion-icon>
  </ion-fab-button>
</ion-fab>
<ion-modal [isOpen]="isEditTimelineModalOpen" [canDismiss]="!isEditTimelineModalOpen">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Modifica Timeline</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeEditSelectedTimelineDialog()">Chiudi</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>      
    <ion-content>
      <ion-item>
        <ion-label position="floating">Date</ion-label>
        <ion-input [disabled]="selectedTimelineId === defaultTimelineId"  type="date" [ngModel]="editingTimeline.mainDate | date:'yyyy-MM-dd'" 
                  (ngModelChange)="formatedDate = $event">
        </ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Note</ion-label>
        <ion-input type="text" [(ngModel)]="editingTimeline.name"></ion-input>
      </ion-item>
      <ion-button expand="full" (click)="updateSelectedTimeline()">Update</ion-button>
    </ion-content>
  </ng-template>
</ion-modal>

<ion-modal [isOpen]="isAddBitOfMyLifeModalOpen" [canDismiss]="!isAddBitOfMyLifeModalOpen">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Aggiungi Nuovo</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeAddBitOfMyLifeDialog()">Chiudi</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content>
      <ion-item>
        <ion-label position="floating">Date</ion-label>
        <ion-input type="date" [ngModel]="newMilestone.date | date:'yyyy-MM-dd'"
                  (ngModelChange)="formatedDate = $event">
        </ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Note</ion-label>
        <ion-input type="text" [(ngModel)]="newMilestone.note"></ion-input>
      </ion-item>
      <ion-button expand="full" (click)="addedBitOfMyLife()">Add</ion-button>
    </ion-content>
  </ng-template>
</ion-modal>

<ion-modal [isOpen]="isEditBitOfMyLifeModalOpen" [canDismiss]="!isEditBitOfMyLifeModalOpen">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Modifica Milestone</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeEditBitOfMyLifeDialog()">Chiudi</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>      
    <ion-content>
      <ion-item>
        <ion-label position="floating">Date</ion-label>
        <ion-input type="date" [ngModel]="editingMilestone.date | date:'yyyy-MM-dd'" 
                  (ngModelChange)="formatedDate = $event">
        </ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Note</ion-label>
        <ion-input type="text" [(ngModel)]="editingMilestone.note"></ion-input>
      </ion-item>
      <ion-button expand="full" (click)="updateBitOfMyLife()">Update</ion-button>
    </ion-content>
  </ng-template>
</ion-modal>