<ion-header>
  <ion-toolbar>
    <ion-title>Bits of My Life</ion-title>
  </ion-toolbar>
</ion-header>
<ion-card *ngIf="appState$ | async as appState">
  <ion-card-content>
    <ion-text color="danger">Errore: {{ appState.error.description }}</ion-text>
  </ion-card-content>
</ion-card>

<app-horizontal-scroll #pageTransition (swipeNext)="nextTimeline()" (swipePrev)="prevTimeline()">
  <div>
      <ion-card>
      <ion-card-header>
        <ion-card-title>Milestones</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <p>Milestones name: {{ (selectedBitsOfMyLifeState$ | async)?.milestonesName }}</p>
        <p>Timeline index: {{ (selectedBitsOfMyLifeState$ | async)?.timelineIndex }}</p>
        <p>Timeline name: {{ (selectedBitsOfMyLifeState$ | async)?.timelineName }}</p>
        <p>Timeline main date: {{ (selectedBitsOfMyLifeState$ | async)?.timelineMainDate | date:'dd/MM/yyyy' }}</p>
        <p>Timelines lenght: {{ (selectedBitsOfMyLifeState$ | async)?.timelinesLenght }}</p>
        <ion-button (click)="this.pageTransition.triggerPrevTransition()">Prev</ion-button>
        <ion-button (click)="this.pageTransition.triggerNextTransition()">Next</ion-button>
      </ion-card-content>
    </ion-card>
    <ion-content style="height: 50vh;">
      <ion-list [inset]="true">
          <ion-item [button]="true" *ngFor="let bit of (selectedBitsOfMyLifeState$ | async)?.bitsOfMyLife">
            <ion-label aria-hidden="true" >{{ bit.milestone.date | date:'dd/MM/yyyy' }}</ion-label>
            <ion-label>
              <strong>{{bit.milestone.note}}</strong><br/>
            <ion-note color="medium" class="ion-text-wrap">
              Years: {{ bit.diff.years }} | Months: {{ bit.diff.months }} | Days: {{ bit.diff.days }}
            </ion-note>
            </ion-label>
            <ion-icon slot="end" name="pencil" *ngIf="bit.milestone.id !== todayMilestoneId" (click)="editBitOfMyLife(bit)"></ion-icon>
            <ion-icon slot="end" name="trash"></ion-icon>
          </ion-item>
    </ion-list>
    <ion-infinite-scroll>
      <ion-infinite-scroll-content></ion-infinite-scroll-content>
    </ion-infinite-scroll>
    </ion-content>
  </div>
</app-horizontal-scroll>

<ion-fab slot="fixed" vertical="bottom" horizontal="end">
  <ion-fab-button (click)="addBitOfMyLife()">
    <ion-icon name="add"></ion-icon>
  </ion-fab-button>
</ion-fab>

  <ion-modal [isOpen]="isEditTimelineModalOpen" [canDismiss]="!isEditTimelineModalOpen">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Modifica Timeline</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeEditTimelineDialog()">Chiudi</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>      
      <ion-content>
        <ion-item>
          <ion-label position="floating">Date</ion-label>
          <ion-input type="date" [ngModel]="editingTimeline.mainDate | date:'yyyy-MM-dd'" 
                    (ngModelChange)="formatedDate = $event">
          </ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Note</ion-label>
          <ion-input type="text" [(ngModel)]="editingTimeline.name"></ion-input>
        </ion-item>
        <ion-button expand="full" (click)="updateTimeline()">Update</ion-button>
      </ion-content>
    </ng-template>
  </ion-modal>

  <ion-modal [isOpen]="isAddBitOfMyLifeModalOpen" [canDismiss]="!isAddBitOfMyLifeModalOpen">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Aggiungi Nuovo</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeAddBitOfMyLigeDialog()">Chiudi</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <ion-item>
          <ion-label position="floating">Date</ion-label>
          <ion-input type="date" [ngModel]="newMilestone.date | date:'yyyy-MM-dd'"
                    (ngModelChange)="formatedDate = $event">
          </ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Note</ion-label>
          <ion-input type="text" [(ngModel)]="newMilestone.note"></ion-input>
        </ion-item>
        <ion-button expand="full" (click)="addedBitOfMyLife()">Add</ion-button>
      </ion-content>
    </ng-template>
  </ion-modal>
  
  <ion-modal [isOpen]="isEditBitOfMyLifeModalOpen" [canDismiss]="!isEditBitOfMyLifeModalOpen">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Modifica Milestone</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeEditBitOfMyLifeDialog()">Chiudi</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>      
      <ion-content>
        <ion-item>
          <ion-label position="floating">Date</ion-label>
          <ion-input type="date" [ngModel]="editingMilestone.date | date:'yyyy-MM-dd'" 
                    (ngModelChange)="formatedDate = $event">
          </ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Note</ion-label>
          <ion-input type="text" [(ngModel)]="editingMilestone.note"></ion-input>
        </ion-item>
        <ion-button expand="full" (click)="updateBitOfMyLife()">Update</ion-button>
      </ion-content>
    </ng-template>
  </ion-modal>
